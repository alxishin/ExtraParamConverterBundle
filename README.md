BuExtraParamConverterBundle
=============

Todo: update the read me with our additions

BuExtraParamConverterBundle extends [Sensio ParamConverter](http://symfony.com/doc/current/bundles/SensioFrameworkExtraBundle/annotations/converters.html) functionality, allowing to convert simple GET and complex POST data to entities, decode json data and strip tags from data.

Requires [SensioFrameworkExtraBundle](http://symfony.com/doc/current/bundles/SensioFrameworkExtraBundle/index.html).

[![Build Status](https://secure.travis-ci.org/Fludimir/ExtraParamConverterBundle.png?branch=master)](http://travis-ci.org/Fludimir/ExtraParamConverterBundle)

Installation
-------------
Add bundle with composer: 

`composer require bu/extra-param-converter-bundle dev-master`

Register bundle in AppKernel.php:
``` php
<?php
// app/AppKernel.php

public function registerBundles()
{
    $bundles = array(
        // ...
        new Bu\ExtraParamConverterBundle\BuExtraParamConverterBundle(),
    );
}
```

Sensio ParamConverter should be enabled, ie parameter `sensio_framework_extra.request.converters` in your app config should be set to true (set by default).


Usage
-------------
**GetConverter**

You don't need to write any annotations, following code will work with any GET request with `user` parameter, like "/getUserDetails?user=123"
``` php
public function detailsAction(User $user)
{
    ...
}
```
where 123 is user id. It will throw NotFoundHttpException if can't find User by this id.

**PostConverter**
``` php
use Bu\ExtraParamConverterBundle\Configuration\ExtraParamConverter;

    /**
     * @ExtraParamConverter("data", jsonData=true, stripTags=true, namespace="App", entities={"groups"={"class"="Group"}, "role"={"class"="Role"}})
     */
    public function saveUserAction(array $data)
    {
        // $data['groups'] ...
    }
```
In this example:

 * raw post data will be json-decoded (jsonData=false by default for standard form submit)
 * all string values will be filtered (stripTags=false by default)
 * all "groups" will converted to "Group" entities, array [id1, id2, id3] - to array of "App:Group" entities
 * all "role" will converted to "Role" entity, single value to single entity
 * all is processed recursively to deepest level
 * result will available in $data (confugired by first unnamed parameter in annotation)
 * exceptions will be thrown in number of incorrect situations:
    * invalid json data, invalid post data
    * entities are defined without namespace (you can ommit them both if want only jsonDecode/stripTags)
    * key defined for entity not found in data
    * any entity not found by id


Recommented to set doctrine mapping alias for your bundle:
```
# Doctrine Configuration
doctrine:
    orm:
        mappings:
            ApplicationMySuperBundle:
                alias: My
```
This will allow you to use short namespace "My" instead of long autogenerated "ApplicationMySuperBundle".

License
-------
This bundle is under the MIT license.
